<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>写在前面 | reb1orn</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="reb1orn的前端日记">
    
    <link rel="preload" href="/assets/css/0.styles.c8e23b86.css" as="style"><link rel="preload" href="/assets/js/app.2720869f.js" as="script"><link rel="preload" href="/assets/js/2.3de34db3.js" as="script"><link rel="preload" href="/assets/js/11.a9b9c817.js" as="script"><link rel="prefetch" href="/assets/js/10.f959e45c.js"><link rel="prefetch" href="/assets/js/12.a0f1527b.js"><link rel="prefetch" href="/assets/js/13.04371baf.js"><link rel="prefetch" href="/assets/js/14.6aba77b8.js"><link rel="prefetch" href="/assets/js/15.71a2da8f.js"><link rel="prefetch" href="/assets/js/3.2c99a915.js"><link rel="prefetch" href="/assets/js/4.bc71b139.js"><link rel="prefetch" href="/assets/js/5.722902a6.js"><link rel="prefetch" href="/assets/js/6.498ab014.js"><link rel="prefetch" href="/assets/js/7.3822cadf.js"><link rel="prefetch" href="/assets/js/8.1a2b92c2.js"><link rel="prefetch" href="/assets/js/9.70ac334b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c8e23b86.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/nav.jpeg" alt="reb1orn" class="logo"> <span class="site-name can-hide">reb1orn</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaScript" class="mobile-dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/JavaScript/memory.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  垃圾回收
</a></li><li class="dropdown-item"><!----> <a href="/pages/JavaScript/eventLoop.html" class="nav-link">
  事件循环
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React" class="dropdown-title"><span class="title">React</span> <span class="arrow down"></span></button> <button type="button" aria-label="React" class="mobile-dropdown-title"><span class="title">React</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/react/Hooks.html" class="nav-link">
  Hooks
</a></li><li class="dropdown-item"><!----> <a href="/pages/react/redux.html" class="nav-link">
  Redux
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/vue/vite.html" class="nav-link">
  Vite
</a></li><li class="dropdown-item"><!----> <a href="/pages/vue/vue3.html" class="nav-link">
  vue3.0
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="HTTP" class="dropdown-title"><span class="title">HTTP</span> <span class="arrow down"></span></button> <button type="button" aria-label="HTTP" class="mobile-dropdown-title"><span class="title">HTTP</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/HTTP/http.html" class="nav-link">
  HTTP
</a></li><li class="dropdown-item"><!----> <a href="/pages/HTTP/https.html" class="nav-link">
  HTTPS
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/reb1orn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaScript" class="mobile-dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/JavaScript/memory.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  垃圾回收
</a></li><li class="dropdown-item"><!----> <a href="/pages/JavaScript/eventLoop.html" class="nav-link">
  事件循环
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React" class="dropdown-title"><span class="title">React</span> <span class="arrow down"></span></button> <button type="button" aria-label="React" class="mobile-dropdown-title"><span class="title">React</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/react/Hooks.html" class="nav-link">
  Hooks
</a></li><li class="dropdown-item"><!----> <a href="/pages/react/redux.html" class="nav-link">
  Redux
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/vue/vite.html" class="nav-link">
  Vite
</a></li><li class="dropdown-item"><!----> <a href="/pages/vue/vue3.html" class="nav-link">
  vue3.0
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="HTTP" class="dropdown-title"><span class="title">HTTP</span> <span class="arrow down"></span></button> <button type="button" aria-label="HTTP" class="mobile-dropdown-title"><span class="title">HTTP</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/HTTP/http.html" class="nav-link">
  HTTP
</a></li><li class="dropdown-item"><!----> <a href="/pages/HTTP/https.html" class="nav-link">
  HTTPS
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/reb1orn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/JavaScript/eventLoop.html" class="sidebar-link">事件循环</a></li><li><a href="/pages/JavaScript/memory.html" aria-current="page" class="active sidebar-link">内存回收</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/JavaScript/memory.html#写在前面" class="sidebar-link">写在前面</a></li><li class="sidebar-sub-header"><a href="/pages/JavaScript/memory.html#内存管理" class="sidebar-link">内存管理</a></li><li class="sidebar-sub-header"><a href="/pages/JavaScript/memory.html#垃圾回收" class="sidebar-link">垃圾回收</a></li><li class="sidebar-sub-header"><a href="/pages/JavaScript/memory.html#总结" class="sidebar-link">总结</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="写在前面"><a href="#写在前面" class="header-anchor">#</a> 写在前面</h2> <p>像C语言这种底层语言，一般都有底层的内存管理接口，比如malloc()和free()。相反，JavaScript是在创建变量（对象，字符串等）时自动进行了分配内存，并且在不使用它们时“自动”释放。 释放的过程称为垃圾回收。这个“自动”是混乱的根源，并让JavaScript（和其他高级语言）开发者错误的感觉他们可以不关心内存管理。</p> <h2 id="内存管理"><a href="#内存管理" class="header-anchor">#</a> 内存管理</h2> <h3 id="内存的生命周期"><a href="#内存的生命周期" class="header-anchor">#</a> 内存的生命周期</h3> <p>不管是什么语言，内存的生命周期基本是一致的：</p> <ul><li>分配所需要的内存</li> <li>使用分配到的内存（读，写）</li> <li>不需要时将其释放/归还</li></ul> <h3 id="内存分配"><a href="#内存分配" class="header-anchor">#</a> 内存分配</h3> <p>在定义变量时，就完成了内存分配。</p> <div class="language- extra-class"><pre class="language-text"><code>var n = 123; // 给数值变量分配内存
var s = &quot;azerty&quot;; // 给字符串分配内存

var o = {
  a: 1,
  b: null
}; // 给对象及其包含的值分配内存


</code></pre></div><h3 id="使用内存"><a href="#使用内存" class="header-anchor">#</a> 使用内存</h3> <p>这个过程实际上就是对分配的内存进行读取和写入的操作。</p> <h3 id="当内存不再需要时释放"><a href="#当内存不再需要时释放" class="header-anchor">#</a> 当内存不再需要时释放</h3> <p>大部分内存管理问题出现在这里，原因是难以找到哪些被分配的内存确实不再需要了，需要开发人员手动来释放。</p> <p>JavaScript嵌入了‘垃圾回收器’，主要目的是跟踪内存的分配和使用，以便当分配的内存不再需要时，自动释放。</p> <p>但这并不能完全解决上述的问题，因为要知道是否仍然需要这块内存是无法判定的。</p> <h2 id="垃圾回收"><a href="#垃圾回收" class="header-anchor">#</a> 垃圾回收</h2> <p>如上所述自动寻找是否一些内存“不再需要”的问题是无法判定的。因此，垃圾回收实现只能有限制的解决一般问题。</p> <h3 id="引用"><a href="#引用" class="header-anchor">#</a> 引用</h3> <p>垃圾回收算法主要依赖于引用的概念。在内存管理的环境中，一个对象如果有访问另一个对象的权限（隐式或者显式），叫做一个对象引用另一个对象。例如，一个Javascript对象具有对它原型的引用（隐式引用）和对它属性的引用（显式引用）。</p> <p>在这里，“对象”的概念不仅特指 JavaScript 对象，还包括函数作用域（或者全局词法作用域）。</p> <h3 id="分类"><a href="#分类" class="header-anchor">#</a> 分类</h3> <p>现在垃圾回收机制一般有两种方式：</p> <ul><li>引用计数</li> <li>标记-清除</li></ul> <h3 id="引用计数"><a href="#引用计数" class="header-anchor">#</a> 引用计数</h3> <p>这是最初级的算法，<strong>此算法把‘对象是否不再需要’简化为‘对象有没有被其他对象引用’。</strong> 如果没有引用该对象（零引用），对象将被回收。</p> <div class="language- extra-class"><pre class="language-text"><code>var o = { 
  a: {
    b:2
  }
}; 
// 两个对象被创建，一个作为另一个的属性被引用，另一个被分配给变量o
// 很显然，没有一个可以被垃圾收集


var o2 = o; // o2变量是第二个对“这个对象”的引用

o = 1;      // 现在，“这个对象”的原始引用o被o2替换了

var oa = o2.a; // 引用“这个对象”的a属性
// 现在，“这个对象”有两个引用了，一个是o2，一个是oa

o2 = &quot;yo&quot;; // 最初的对象现在已经是零引用了
           // 他可以被垃圾回收了
           // 然而它的属性a的对象还在被oa引用，所以还不能回收

oa = null; // a属性的那个对象现在也是零引用了
           // 它可以被垃圾回收了
</code></pre></div><h4 id="限制"><a href="#限制" class="header-anchor">#</a> 限制</h4> <p>此算法有个限制：<strong>无法处理循环引用的事例。</strong></p> <div class="language- extra-class"><pre class="language-text"><code>function f(){
  var o = {};
  var o2 = {};
  o.a = o2; // o 引用 o2
  o2.a = o; // o2 引用 o

  return &quot;azerty&quot;;
}

f();
</code></pre></div><p>此事例中，两个对象被创建，并互相引用，形成了一个循环。它们被调用之后会离开函数作用域，所以它们已经没有用了，可以被回收了。然而，引用计数算法考虑到它们互相都有至少一次引用，所以它们不会被回收。</p> <p><em><strong>IE 6, 7 使用引用计数方式对 DOM 对象进行垃圾回收。该方式常常造成对象被循环引用时内存发生泄漏。</strong></em></p> <div class="language- extra-class"><pre class="language-text"><code>var div;
window.onload = function(){
  div = document.getElementById(&quot;myDivElement&quot;);
  div.circularReference = div;
  div.lotsOfData = new Array(10000).join(&quot;*&quot;);
};
</code></pre></div><p>myDivElement 这个 DOM 元素里的 circularReference 属性引用了 myDivElement，造成了循环引用。如果该属性没有显示移除或者设为 null，引用计数式垃圾收集器将总是且至少有一个引用，并将一直保持在内存里的 DOM 元素，即使其从DOM 树中删去了。如果这个 DOM 元素拥有大量的数据 (如上的 lotsOfData 属性)，而这个数据占用的内存将永远不会被释放。</p> <h3 id="标记-清除"><a href="#标记-清除" class="header-anchor">#</a> 标记-清除</h3> <p><strong>这个算法把‘对象是否不再需要’定义为 ‘对象是否可以获得’</strong>,
这个算法假定设置一个叫做根（root）的对象（在Javascript里，根是全局对象）。垃圾回收器将定期从根开始，找所有从根开始引用的对象，然后找这些对象引用的对象……从根开始，垃圾回收器将找到所有可以获得的对象和收集所有不能获得的对象。</p> <p>从2012年起，所有现代浏览器都使用了标记-清除垃圾回收算法。所有对JavaScript垃圾回收算法的改进都是基于标记-清除算法的改进，并没有改进标记-清除算法本身和它对“对象是否不再需要”的简化定义。</p> <h4 id="循环引用不再是问题"><a href="#循环引用不再是问题" class="header-anchor">#</a> 循环引用不再是问题</h4> <p>在上面的示例中，函数调用返回之后，两个对象从全局对象出发无法获取。因此，他们将会被垃圾回收器回收。第二个示例同样，一旦 div 和其事件处理无法从根获取到，他们将会被垃圾回收器回收。</p> <p>但依然有个小小限制，即那些无法从根对象查询到的对象将会被清除。
但在实践中，很少会碰到类似情况，这也是我们不太关心垃圾回收机制的原因。</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>内存的生命周期分为三个部分，我们在定义变量时，占用了内存，在经历了相关操作后，变量不再需要时，将相关对象回收，释放内存。那如何回收呢，提供了两种方法，引用计数和标记清除，引用计数有个比较大的限制，那就是无法回收循环引用的对象，而标记清除方法不存在这个问题，虽然依然有个小小限制，但无伤大雅，二者区别在于算法定义的不同，以及基于此的算法方式不同。由此可见，垃圾回收并不能完全将不再需要的变量回收，这只是个优化内存的方式。</p> <h1 id="参考文章"><a href="#参考文章" class="header-anchor">#</a> 参考文章</h1> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Memory_Management" target="_blank" rel="noopener noreferrer">内存管理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pages/JavaScript/eventLoop.html" class="prev">
        事件循环
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2720869f.js" defer></script><script src="/assets/js/2.3de34db3.js" defer></script><script src="/assets/js/11.a9b9c817.js" defer></script>
  </body>
</html>
